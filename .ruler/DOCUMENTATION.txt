# Ruler Documentation - Enhanced Guide

**Centralised Rule Management**: Store all AI instructions in a dedicated `.ruler/` directory using Markdown files

---

## Getting Started

### Installation

**Global Installation (Recommended for CLI use):**
```bash
npm install -g @intellectronica/ruler
```

**Using npx (for one-off commands):**
```bash
npx @intellectronica/ruler apply
```

### Project Initialisation

1. Navigate to your project's root directory
2. Run `ruler init`
3. This creates:
   - `.ruler/` directory
   - `.ruler/AGENTS.md`: The primary starter Markdown file for your rules
   - `.ruler/ruler.toml`: The main configuration file for Ruler (now contains sample MCP server sections; legacy `.ruler/mcp.json` no longer scaffolded)

**Optional legacy fallback**: If you previously used `.ruler/instructions.md`, it is still respected when `AGENTS.md` is absent. (The prior runtime warning was removed.)

Additionally, you can create a global configuration to use when no local `.ruler/` directory is found:
```bash
ruler init --global
```

The global configuration will be created to `$XDG_CONFIG_HOME/ruler` (default: `~/.config/ruler`).

### Complete Setup Workflow

1. **Initialize**: `ruler init` (creates structure)
2. **Customize**: Edit `.ruler/AGENTS.md` with your rules
3. **Configure**: Edit `.ruler/ruler.toml` to enable desired agents
4. **Apply**: `ruler apply` (generates agent-specific files)
5. **Commit**: Commit `.ruler/` directory to version control

---

## Core Concepts

### The `.ruler/` Directory

This is your central hub for all AI agent instructions:

**Primary File Order & Precedence:**
1. A repository root `AGENTS.md` (outside `.ruler/`) if present (highest precedence, prepended)
2. `.ruler/AGENTS.md` (new default starter file)
3. Legacy `.ruler/instructions.md` (only if `.ruler/AGENTS.md` absent; no longer emits a deprecation warning)
4. Remaining discovered `.md` files under `.ruler/` (and subdirectories) in sorted order

**Rule Files (*.md)**: Discovered recursively from `.ruler/` or `$XDG_CONFIG_HOME/ruler` and concatenated in the order above

**Concatenation Marker**: Each file's content is prepended with `<!-- Source: <relative_path_to_md_file> -->` for traceability

**ruler.toml**: Master configuration for Ruler's behavior, agent selection, and output paths

**mcp.json**: Shared MCP server settings

This ordering lets you keep a short, high-impact root `AGENTS.md` (e.g. executive project summary) while housing detailed guidance inside `.ruler/`.

### Source vs. Generated Files

**Important**: Root-level `AGENTS.md` and `CLAUDE.md` files generated by `ruler apply` are auto-managed and should not be edited manually. Always edit `.ruler/AGENTS.md` and run `ruler apply` to regenerate agent-specific files.

**Note**: The precedence order above applies to manually created rule files. Files generated by `ruler apply` (like root `AGENTS.md` for Cursor) are always overwritten and should not be manually edited.

### Typical Workflow

```
Edit .ruler/AGENTS.md → Run `ruler apply` → Agents read generated files
     (source)              (generate)           (CLAUDE.md, AGENTS.md)
```

### Automatic .gitignore Management

Ruler automatically adds generated files (like root `AGENTS.md` and `CLAUDE.md`) to your `.gitignore` to prevent committing auto-generated content. The `.ruler/` directory should be committed to version control.

---

## Porting Rules to a New Project

To reuse your rules in a new project:

1. **Initialize Ruler in the new project:**
   ```bash
   cd /path/to/new-project
   ruler init
   ```

2. **Copy your custom rules:**
   ```bash
   cp /path/to/source-project/.ruler/AGENTS.md /path/to/new-project/.ruler/
   cp /path/to/source-project/.ruler/ruler.toml /path/to/new-project/.ruler/
   ```

3. **Review and customize:**
   - Update project-specific context in `AGENTS.md`
   - Adjust agent settings in `ruler.toml` if needed

4. **Apply the rules:**
   ```bash
   ruler apply
   ```

**Quick one-liner:**
```bash
cp -r /path/to/source-project/.ruler /path/to/new-project/ && \
cd /path/to/new-project && \
ruler apply
```

---

## Nested Rule Loading

Ruler now supports nested rule loading with the `--nested` flag, enabling context-specific instructions for different parts of your project:

```
project/
├── .ruler/           # Global project rules
│   ├── AGENTS.md
│   └── coding_style.md
├── src/
│   └── .ruler/       # Component-specific rules
│       └── api_guidelines.md
├── tests/
│   └── .ruler/       # Test-specific rules
│       └── testing_conventions.md
└── docs/
    └── .ruler/       # Documentation rules
        └── writing_style.md
```

**How it works:**

1. Discover all `.ruler/` directories in the project hierarchy
2. Load and concatenate rules from each directory in order
3. Decide whether nested mode is enabled using the following precedence:
   - `ruler apply --nested` (or `--no-nested`) takes top priority
   - `nested = true` in `ruler.toml`
   - Default to disabled when neither option is provided
4. When a run is nested, downstream configs are forced to keep `nested = true`. If a child config attempts to disable it, Ruler keeps nested processing active and emits a warning in the logs.
5. Nested processing carries forward each directory's own MCP bundle and configuration settings so that generated files remain scoped to their source directories while being normalized back to the project root.

**Caution**: Nested mode is experimental and may change in future releases. The CLI logs this warning the first time a nested run is detected so you know the behavior may evolve.

**Perfect for:**
- Monorepos with multiple services
- Projects with distinct components (frontend/backend)
- Teams needing different instructions for different areas
- Complex codebases with varying standards

---

## Best Practices for Rule Files

### Granularity

Break down complex instructions into focused `.md` files:

- `coding_style.md`
- `api_conventions.md`
- `project_architecture.md`
- `security_guidelines.md`

### Example Rule File

Example rule file (`.ruler/python_guidelines.md`):

```markdown
# Python Project Guidelines

## General Style

- Follow PEP 8 for all Python code
- Use type hints for all function signatures and complex variables
- Keep functions short and focused on a single task

## Error Handling

- Use specific exception types rather than generic `Exception`
- Log errors effectively with context

## Security

- Always validate and sanitize user input
- Be mindful of potential injection vulnerabilities
```

### Organizing Large Rule Sets

For comprehensive rule sets, consider this structure:

```
.ruler/
├── AGENTS.md              # Main entry point, project overview
├── coding-standards.md    # Code style and conventions
├── architecture.md        # System design patterns
├── communication.md       # Writing and communication guidelines
├── workflows.md           # Development workflows
└── agent-specific/        # Agent-specific instructions
    ├── cursor.md
    └── claude.md
```

---

## Troubleshooting

### Common Issues

**Q: I edited the root `AGENTS.md` but my changes disappeared?**  
A: Root files are auto-generated. Edit `.ruler/AGENTS.md` instead, then run `ruler apply`.

**Q: How do I see what rules are being applied?**  
A: Run `ruler apply --verbose` to see detailed processing information.

**Q: Can I have different rules for different agents?**  
A: Currently all agents receive the same concatenated rules. Use conditional sections in your `AGENTS.md` like "## Cursor Specific" or "## Claude Code Specific" if needed.

**Q: My generated files aren't updating?**  
A: Check that the agent is enabled in `ruler.toml` and verify agent isn't excluded by `--agents` flag. Use `--verbose` to see detailed execution logs.

**Q: Configuration validation errors?**  
A: Ruler validates `ruler.toml` format and will show specific error details. Check that all configuration values match the expected types and formats.

### Debug Mode

Use `--verbose` flag to see detailed execution logs:

```bash
ruler apply --verbose
```

This shows:
- Configuration loading details
- Agent selection logic
- File processing information
- MCP configuration steps

---

## Advanced Usage

### Agent-Specific Configuration

You can enable/disable agents and override their default output paths in `ruler.toml`:

```toml
[agents.cursor]
enabled = true

[agents.claude]
enabled = true
output_path = "CLAUDE.md"  # Custom output path
```

### MCP Server Configuration

Define Model Context Protocol servers in `ruler.toml`:

```toml
[mcp_servers.example_stdio]
command = "node"
args = ["scripts/your-mcp-server.js"]
env = { API_KEY = "replace_me" }

[mcp_servers.example_remote]
url = "https://api.example.com/mcp"
headers = { Authorization = "Bearer REPLACE_ME" }
```

### Git Integration

Ruler automatically manages your `.gitignore` file:
- Creates or updates `.gitignore` in your project root
- Adds paths to a managed block marked with `# START Ruler Generated Files` and `# END Ruler Generated Files`
- Preserves existing content outside this block
- Sorts paths alphabetically and uses relative POSIX-style paths

**Control options:**
- CLI flags: `--gitignore` or `--no-gitignore`
- Configuration: `[gitignore].enabled` in `ruler.toml`
- Default: enabled

---

## Integration Examples

### NPM Scripts

```json
{
  "scripts": {
    "ruler:apply": "ruler apply",
    "dev": "npm run ruler:apply && your_dev_command",
    "precommit": "npm run ruler:apply"
  }
}
```

### GitHub Actions

```yaml
# .github/workflows/ruler-check.yml
name: Check Ruler Configuration
on:
  pull_request:
    paths: ['.ruler/**']

jobs:
  check-ruler:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
      - name: Install Ruler
        run: npm install -g @intellectronica/ruler
      - name: Apply Ruler configuration
        run: ruler apply --no-gitignore
      - name: Check for uncommitted changes
        run: |
          if [[ -n $(git status --porcelain) ]]; then
            echo "::error::Ruler configuration is out of sync!"
            echo "Please run 'ruler apply' locally and commit the changes."
            exit 1
          fi
```

---

## FAQ

**Q: Can I use different rules for different agents?**  
A: Currently, all agents receive the same concatenated rules. For agent-specific instructions, include sections in your rule files like "## GitHub Copilot Specific" or "## Aider Configuration".

**Q: How do I set up different instructions for different parts of my project?**  
A: Enable nested mode either by setting `nested = true` in `ruler.toml` or by passing `ruler apply --nested`. The CLI inherits the config setting by default, but `--no-nested` always wins if you need to opt out for a run.

**Q: How do I temporarily disable Ruler for an agent?**  
A: Set `enabled = false` in `ruler.toml` under `[agents.agentname]`, or use `--agents` flag to specify only the agents you want.

**Q: What happens to my existing agent configuration files?**  
A: Ruler creates backups with `.bak` extension before overwriting any existing files.

**Q: Can I run Ruler in CI/CD pipelines?**  
A: Yes! Use `ruler apply --no-gitignore` in CI to avoid modifying `.gitignore`. See the GitHub Actions example above.

**Q: How do I migrate from older versions using `instructions.md`?**  
A: Simply rename `.ruler/instructions.md` to `.ruler/AGENTS.md` (recommended). If you keep the legacy file and omit `AGENTS.md`, Ruler will still use it (without emitting the old deprecation warning). Having both causes `AGENTS.md` to take precedence; the legacy file is still concatenated afterward.

---

## Command Reference

### `ruler init`

Scaffold a `.ruler/` directory with default files.

**Options:**
- `--project-root <path>`: Project root directory (default: current directory)
- `--global`: Initialize in global config directory (`$XDG_CONFIG_HOME/ruler`)

### `ruler apply`

Apply ruler configurations to supported AI agents.

**Options:**
- `--agents <list>`: Specify which agents to apply (e.g., `--agents cursor claude`)
- `--nested`: Enable nested rule loading
- `--no-nested`: Disable nested rule loading
- `--gitignore`: Manage `.gitignore` (default: enabled)
- `--no-gitignore`: Skip `.gitignore` management
- `--verbose`: Show detailed execution logs

### `ruler revert`

Revert ruler configurations from supported AI agents.

**Options:**
- `--agents <list>`: Specify which agents to revert
- `--verbose`: Show detailed execution logs

---

## Additional Resources

- **Official Documentation**: https://ai.intellectronica.net/ruler
- **GitHub Repository**: https://github.com/intellectronica/ruler
- **MCP Registry**: https://mcp-registry.com

---

**Version**: Enhanced Guide v1.0  
**Last Updated**: January 8, 2026  
**Based on**: Ruler v0.3.21+
